---
title: "Document title"
subtitle: "Subtitle of document"
author:
  - name: Jane Doe
    affiliations:
      - name: University of Hamburg
        department: Biology Department
      - name: Institute of Something
        address: Hamburg, Germany
    email: jane.doe@uni-hamburg.de
  - name: John Doe
    affiliations:
      - name: University of Hamburg
        department: Biology Department
date: "`r Sys.Date()`"
### Comment or remove the following line if NO summary should be shown on the title page
abstract: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ut elit odio. Donec fermentum tellus neque, vitae fringilla orci pretium vitae. Fusce maximus finibus facilisis. Donec ut ullamcorper turpis. Donec ut porta ipsum. Nullam cursus mauris a sapien ornare pulvinar. Aenean malesuada molestie erat quis mattis. Praesent scelerisque posuere faucibus."
logo1: images/uhh_logo.png  # logo on left side of title page
logo2: images/min_logo.png  # logo on right side of title page
### Uncomment the following line if the document language is German
# language: custom_lang.yml
### Comment or remove the following two lines if NO references are used
bibliography: [bib/references.bib, bib/packages.bib] # Path to bibliography files 
csl: bib/sage-harvard.csl                            # Path to reference style file
### Settings for rendering the document:
format: 
  pdf:
    documentclass: scrbook  
    classoption: ["onepage", "openany"]
    geometry:   
      - top=25mm     # margin settings
      - bottom=35mm
      - left=25mm
      - right=25mm
      - heightrounded
    template-partials:
      - "styles/before-body.tex"
      - "styles/_titlepage.tex" 
      - "styles/_coverpage.tex" 
    include-in-header:
    - "styles/in-header.tex"
    # Options for front cover
    cover-bg-image: "images/cover.png"
    cover-page-color: "7EB7DF"  # provide hex color code
    cover-text-color: "3A515C"  # provide hex color code
    cover-fade-effect: true
    # Options for table of content
    toc: true
    toc-depth: 3
    toc-title: Contents       # remove line or adjust if language is German
    number-sections: true
    number-depth: 3
    lof: false  # list of figures
    lot: false  # list of tables
    colorlinks: true
    crossref: 
      chapters: false     # set to 'true' if figure numbering should follow subsections
      fig-prefix: Fig.    # (default is 'Figure'; adjust if language is German)
    # Code options:
    highlight-style: arrow # default 
execute:
  echo: false
  warning: false
  message: false
fig-align: center
editor: source
params:
  plotA_x_1: null
  plotA_x_2: null
  plotA_x_3: null
  plotA_notes_1: null
  plotA_notes_2: null
  plotA_notes_3: null
  plotB_x_1: null
  plotB_x_2: null
  plotB_x_3: null
  plotB_notes_1: null
  plotB_notes_2: null
  plotB_notes_3: null
  bookmark_url: null
---

```{r}
#| label: load-packages
#| include: false
# Load all your packages that you need later
library(knitr)
library(ggplot2)
#library(survival)
#library(survminer)
#library(networkD3)
#library(DT)

color_bg <- "#FFFFFF"
color_plot_background <- "#FFFFFF"
color_fg <- "#0B1C72"
color_primary <- "#D62727"
color_success <- "#8A9C40"
color_warning <- "#FFA500"
color_plotA_point <- color_primary
color_plotA_line <- color_warning
color_plotB_point <- color_success
color_plotB_line <- color_warning
```


```{r, collapse=TRUE}
#| label: print-params

options(digits = 4)

print(params)
```


# Dynamic Report

See [site](`r params$bookmark_url`)

## Regression Analysis

Here are my regression models:

### Plot A Models

```{r, collapse=TRUE, results='asis'}

# Get all Plot A parameters that are not NULL
plotA_params <- params[grepl("^plotA_x_", names(params))]
plotA_params <- plotA_params[!sapply(plotA_params, is.null)]

if (length(plotA_params) > 0) {
  for (i in 1:length(plotA_params)) {
    param_name <- names(plotA_params)[i]
    x_var <- plotA_params[[i]]
    
    cat("\n#### Plot A", i, "\n")
    cat("Variable:", x_var, "\n\n")
    
    fml <- as.formula(paste("mpg ~", x_var))
    fit <- lm(fml, data = mtcars)
    b <- coef(fit)
    
    print(summary(fit))
    cat("\nThe fitting result is: mpg =", round(b[1], 4), "+", round(b[2], 4), "*", x_var, "\n\n")
  }
} else {
  cat("No Plot A variables configured.\n\n")
}
```

### Plot B Models


```{r, collapse=TRUE, results='asis'}
# Get all Plot B parameters that are not NULL
plotB_params <- params[grepl("^plotB_x_", names(params))]
plotB_params <- plotB_params[!sapply(plotB_params, is.null)]

if (length(plotB_params) > 0) {
  for (i in 1:length(plotB_params)) {
    param_name <- names(plotB_params)[i]
    x_var <- plotB_params[[i]]
    
    cat("\n#### Plot B", i, "\n")
    cat("Variable:", x_var, "\n\n")
    
    fml <- as.formula(paste("mpg ~", x_var))
    fit <- lm(fml, data = mtcars)
    b <- coef(fit)
    
    print(summary(fit))
    cat("\nThe fitting result is: mpg =", round(b[1], 4), "+", round(b[2], 4), "*", x_var, "\n\n")
  }
} else {
  cat("No Plot B variables configured.\n\n")
}
```

## Scatter Plots with Regression Lines
### Plot A Visualizations


```{r}
#| label: fig-plotA
#| fig-cap: "Plot A: Regression Analysis Visualizations"
#| fig-subcap: 
#|   - "Plot A"
#|   - "Plot A"
#|   - "Plot A"
#| layout-ncol: 2
#| fig-height: 4
#| fig-width: 5

# Get all Plot A parameters that are not NULL
plotA_params <- params[grepl("^plotA_x_", names(params))]
plotA_params <- plotA_params[!sapply(plotA_params, is.null)]

if (length(plotA_params) > 0) {
  for (i in 1:length(plotA_params)) {
    x_var <- plotA_params[[i]]
    
    p <- ggplot(mtcars, aes(x = .data[[x_var]], y = mpg)) +
      geom_point(color = color_plotA_point, size = 3) +
      geom_smooth(method = "lm", se = FALSE, color = color_plotA_line) +
      theme_minimal() +
      labs(title = paste("Plot A", i), x = x_var, y = "mpg") +
      theme(
        plot.background = element_rect(fill = color_plot_background, color = NA),
        panel.background = element_rect(fill = color_plot_background, color = NA),
        text = element_text(color = color_fg),
        axis.text = element_text(color = color_fg),
        axis.title = element_text(color = color_fg),
        plot.title = element_text(face = "bold")
      )
    
    print(p)
  }
}
```

```{r, results='asis'}
#| label: plotA-notes

# Get all Plot A parameters that are not NULL
plotA_params <- params[grepl("^plotA_x_", names(params))]
plotA_params <- plotA_params[!sapply(plotA_params, is.null)]

if (length(plotA_params) > 0) {
  for (i in 1:length(plotA_params)) {
    notes_param <- paste0("plotA_notes_", i)
    notes <- if (!is.null(params[[notes_param]]) && params[[notes_param]] != "") params[[notes_param]] else NULL
    
    # Add notes if they exist
    if (!is.null(notes)) {
      cat("\n**Notes for Plot A", i, ":**", notes, "\n\n")
    }
  }
}
```

See @fig-plotA-1.

### Plot B Visualizations

```{r}
# Get all Plot B parameters that are not NULL
plotB_params <- params[grepl("^plotB_x_", names(params))]
plotB_params <- plotB_params[!sapply(plotB_params, is.null)]


#cap1 <- 'Speed vs Distance'
#cap2 <- "Weight vs MPG"
#cap3 <- "HP vs MPG"

# Set chunk options
knitr::opts_chunk$set(
  fig.subcap = sapply(plotB_params, function(x) paste0("Var: ", x))
)
```

```{r}
#| label: fig-plotB
#| fig-cap: "Plot B: Regression Analysis Visualizations"
#| layout-ncol: 2
#| fig-height: 4
#| fig-width: 5

if (length(plotB_params) > 0) {
  for (i in 1:length(plotB_params)) {
    x_var <- plotB_params[[i]]
    
    p <- ggplot(mtcars, aes(x = .data[[x_var]], y = mpg)) +
      geom_point(color = color_plotB_point, size = 3) +
      geom_smooth(method = "lm", se = FALSE, color = color_plotB_line) +
      theme_minimal() +
      labs(title = paste("Plot B", i), x = x_var, y = "mpg") +
      theme(
        plot.background = element_rect(fill = color_plot_background, color = NA),
        panel.background = element_rect(fill = color_plot_background, color = NA),
        text = element_text(color = color_fg),
        axis.text = element_text(color = color_fg),
        axis.title = element_text(color = color_fg),
        plot.title = element_text(face = "bold")
      )
    
    print(p)
  }
}
```


```{r, results='asis'}
#| label: plotB-notes

# Get all Plot B parameters that are not NULL
plotB_params <- params[grepl("^plotB_x_", names(params))]
plotB_params <- plotB_params[!sapply(plotB_params, is.null)]

if (length(plotB_params) > 0) {
  for (i in 1:length(plotB_params)) {
    notes_param <- paste0("plotB_notes_", i)
    notes <- if (!is.null(params[[notes_param]]) && params[[notes_param]] != "") params[[notes_param]] else NULL
    
    # Add notes if they exist
    if (!is.null(notes)) {
      cat("\n**Notes for Plot B", i, ":**", notes, "\n\n")
    }
  }
}
```