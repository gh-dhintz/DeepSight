---
title: "Document title"
subtitle: "Subtitle of document"
author:
  - name: Jane Doe
    affiliations:
      - name: University of Hamburg
        department: Biology Department
      - name: Institute of Something
        address: Hamburg, Germany
    email: jane.doe@uni-hamburg.de
  - name: John Doe
    affiliations:
      - name: University of Hamburg
        department: Biology Department
date: "`r Sys.Date()`"
### Comment or remove the following line if NO summary should be shown on the title page
abstract: "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aenean ut elit odio. Donec fermentum tellus neque, vitae fringilla orci pretium vitae. Fusce maximus finibus facilisis. Donec ut ullamcorper turpis. Donec ut porta ipsum. Nullam cursus mauris a sapien ornare pulvinar. Aenean malesuada molestie erat quis mattis. Praesent scelerisque posuere faucibus."
logo1: images/uhh_logo.png  # logo on left side of title page
logo2: images/min_logo.png  # logo on right side of title page
### Uncomment the following line if the document language is German
# language: custom_lang.yml
### Comment or remove the following two lines if NO references are used
bibliography: [bib/references.bib, bib/packages.bib] # Path to bibliography files 
csl: bib/sage-harvard.csl                            # Path to reference style file
### Settings for rendering the document:
format: 
  pdf:
    documentclass: scrbook  
    classoption: ["onepage", "openany"]
    geometry:   
      - top=25mm     # margin settings
      - bottom=35mm
      - left=25mm
      - right=25mm
      - heightrounded
    template-partials:
      - "styles/before-body.tex"
      - "styles/_titlepage.tex" 
      - "styles/_coverpage.tex" 
    include-in-header:
    - "styles/in-header.tex"
    # Options for front cover
    cover-bg-image: "images/cover.png"
    cover-page-color: "7EB7DF"  # provide hex color code
    cover-text-color: "3A515C"  # provide hex color code
    cover-fade-effect: true
    # Options for table of content
    toc: true
    toc-depth: 3
    toc-title: Contents       # remove line or adjust if language is German
    number-sections: true
    number-depth: 3
    lof: false  # list of figures
    lot: false  # list of tables
    colorlinks: true
    crossref: 
      chapters: false     # set to 'true' if figure numbering should follow subsections
      fig-prefix: Fig.    # (default is 'Figure'; adjust if language is German)
    # Code options:
    highlight-style: arrow # default 
execute:
  echo: false
  warning: false
  message: false
fig-align: center
editor: source
params:
  plotA_x_1: null
  plotA_x_2: null
  plotB_x_1: null
  bookmark_url: null
---

```{r}
#| label: load-packages
#| include: false
# Load all your packages that you need later
library(knitr)
library(ggplot2)
#library(survival)
#library(survminer)
#library(networkD3)
#library(DT)

color_bg <- "#FFFFFF"
color_plot_background <- "#FFFFFF"
color_fg <- "#0B1C72"
color_primary <- "#D62727"
color_success <- "#8A9C40"
color_warning <- "#FFA500"
color_plotA_point <- color_primary
color_plotA_line <- color_warning
color_plotB_point <- color_success
color_plotB_line <- color_warning
```

```{r}
#| label: generate-package-refs
#| include: false
# Automatically create a bib database for R packages used above
#knitr::write_bib(
#  x = c(.packages(), 'rmarkdown', 'UHHformats',
#    # Add here now all packages that are loaded above:
#    'knitr', 'survival', 'survminer', 'networkD3', 'DT'), 
#  file = 'bib/packages.bib')
```


# Dynamic Report

See [site](`r params$bookmark_url`)

## Regression Analysis

Here are my regression models:

```{r, collapse=TRUE}
options(digits = 4)

cat("plotA_x_1:", params$plotA_x_1, "\n")
fml <- as.formula(paste("mpg ~", params$plotA_x_1))
fit <- lm(fml, data = mtcars)
b <- coef(fit)
summary(fit)
```

```{r, collapse=TRUE}
options(digits = 4)

cat("plotB_x_1:", params$plotB_x_1, "\n")
fml <- as.formula(paste("mpg ~", params$plotB_x_1))
fit <- lm(fml, data = mtcars)
b <- coef(fit)
summary(fit)
```

The fitting result is $mpg = `r b[1]` + `r b[2]``r params$plotB_x_1`$.
Below are scatter plots with the regression lines.

```{r}
#| label: plotA
#| fig-height: 4
#| fig-width: 6

color_plotA_point <- "#D62727"
color_plotA_line <- "#FFA500"
color_plot_background <- "#FFFFFF"
color_fg <- "#0B1C72"

ggplot(mtcars, aes(x = .data[[params$plotA_x_1]], y = mpg)) +
  geom_point(color = color_plotA_point, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = color_plotA_line) +
  theme_minimal() +
  labs(title = "Plot A", x = params$plotA_x_1, y = "mpg") +
  theme(
    plot.background = element_rect(fill = color_plot_background, color = NA),
    panel.background = element_rect(fill = color_plot_background, color = NA),
    text = element_text(color = color_fg),
    axis.text = element_text(color = color_fg),
    axis.title = element_text(color = color_fg),
    plot.title = element_text(face = "bold")
  )
```
```{r}
#| label: plotB
#| fig-height: 4
#| fig-width: 6

color_plotB_point <- "#D62727"
color_plotB_line <- "#FFA500"
color_plot_background <- "#FFFFFF"
color_fg <- "#0B1C72"

ggplot(mtcars, aes(x = .data[[params$plotB_x_1]], y = mpg)) +
  geom_point(color = color_plotB_point, size = 3) +
  geom_smooth(method = "lm", se = FALSE, color = color_plotB_line) +
  theme_minimal() +
  labs(title = "Plot B", x = params$plotB_x_1, y = "mpg") +
  theme(
    plot.background = element_rect(fill = color_plot_background, color = NA),
    panel.background = element_rect(fill = color_plot_background, color = NA),
    text = element_text(color = color_fg),
    axis.text = element_text(color = color_fg),
    axis.title = element_text(color = color_fg),
    plot.title = element_text(face = "bold")
  )
```
